!function(i,a){var t,f,o,n,g,u,m,p,d,v,c,s,e=i(document),l=!1,r=!1,h=0;function w(){if(!l)try{!function(){if(t=i(".attachment-details, .wp_attachment_image"),!(f=t.eq(0).find("img").eq(0)).length||i(".pwad-focal-point-image").length)return;if(o=i(".attachment-actions, .media-sidebar .details"),n=i(".attachment-info .actions"),!(p=jQuery('input[name*="[pwad_id]"]').val())||""==p)return;l=!0;var a={action:"pwad_get_focal_point",image:p};i.ajax({type:"GET",url:ajaxurl,data:a,dataType:"json",success:_})}()}catch(a){l=!1,console.log(a)}}function _(a){l=!1,d=a.focalpoint,v=a.sizes,r=a.smart_cache;var t="",e="";t+='<span class="pwad-focal-point-marker"><span>'+s.drag_focalpoint+"</span></span>",t+='<span class="pwad-focal-point-preview"></span>',e+='<button type="button" class="button pwad-set-focal-point pwad-active" data-id="'+p+'">'+s.set_focalpoint+"</button>",e+='<button type="button" class="button button-primary pwad-save-focal-point">'+s.save_focalpoint+"</button>",e+='<br><select class="pwad-select-focal-point-preview">',i.each(v,function(a,t){t.crop&&(e+='<option value="'+a+'">'+t.name+"</option>")}),e+="</select>",f.wrap('<div class="pwad-focal-point-container"><div class="pwad-focal-point-image"></div></div>').after(t),o.append(e),a.smart_cache&&n.prepend('<a href="#" class="pwad-clear-cache" data-id="'+p+'">'+s.delete_cache+"</a> | "),u=i(".pwad-focal-point-marker"),m=i(".pwad-focal-point-preview"),g=i(".pwad-select-focal-point-preview"),D(d)}function b(){D(d),i(".pwad-set-focal-point").removeClass("pwad-active"),i(".pwad-save-focal-point").addClass("pwad-active"),u.addClass("pwad-active"),m.addClass("pwad-active"),g.addClass("pwad-active"),u.on("mousedown.pwad",A)}function y(){D(d)}function C(){var a={action:"pwad_set_focal_point",image:p,top:d.top,left:d.left};i(".pwad-save-focal-point").prop("disabled",!0),i.ajax({type:"GET",url:ajaxurl,data:a,success:j})}function j(){r?T():function t(){h++;console.log("Regenerate Page "+h);i.ajax({type:"GET",url:ajaxurl,data:{action:"pwad_regenerate_thumbnails",image:p,page:h},success:function(a){console.log("Success",a),"Complete"==a.trim()?T():t()},error:function(){console.log("Error")}})}()}function T(){i(".pwad-set-focal-point").addClass("pwad-active"),i(".pwad-save-focal-point").removeClass("pwad-active"),u.removeClass("pwad-active"),m.removeClass("pwad-active"),g.removeClass("pwad-active"),i(".pwad-save-focal-point").prop("disabled",!1),u.off("mousedown.pwad")}function k(a){if(a.preventDefault(),a.stopPropagation(),$link=i(this),$link.hasClass("loading"))return!1;$link.addClass("loading"),i.ajax({type:"GET",url:ajaxurl,data:{action:"pwad_clear_image_cache",image:$link.data("id")},success:function(){$link.removeClass("loading")}})}function A(a){a.preventDefault(),a.stopPropagation(),(c=f.offset()).width=f.width(),c.height=f.height(),i(window).on("mousemove.pwad",x),i(window).on("mouseup.pwad",W),x(a)}function x(a){a.preventDefault(),a.stopPropagation();var t=a.pageY-c.top,e=a.pageX-c.left;t<0&&(t=0),t>c.height&&(t=c.height),e<0&&(e=0),e>c.width&&(e=c.width),D(d={top:t/c.height,left:e/c.width})}function W(a){a.preventDefault(),a.stopPropagation(),i(window).off("mousemove.pwad"),i(window).off("mouseup.pwad")}function D(a){if(u.css({top:100*a.top+"%",left:100*a.left+"%"}),f.length&&m.length){var t=g.val(),e=!!v[t]&&v[t],i=f.width(),o=f.height(),n=i,p=o,d=0,c=0;if(e&&0<e.width&&0<e.height){var s=0,l=0,r=1;r=o/i,imageWidth=e.width,imageHeight=e.width*r,imageHeight<e.height&&(r=i/o,imageHeight=e.height,imageWidth=e.height*r);var h=e.width/i,w=e.height/o;s=imageWidth*parseFloat(a.left)-i/2*h,l=imageHeight*parseFloat(a.top)-o/2*w,s<0&&(s=0),s+e.width>imageWidth&&(s-=s+e.width-imageWidth),l<0&&(l=0),l+e.height>imageHeight&&(l-=l+e.height-imageHeight),c=s*(i/imageWidth),d=l*(o/imageHeight),n=e.width*(i/imageWidth),p=e.height*(o/imageHeight)}m.css({width:n/i*100+"%",height:p/o*100+"%",left:c/i*100+"%",top:d/o*100+"%"})}}e.ready(function(){"undefined"!=typeof PWAD_TRANSLATION_DATA&&(s=PWAD_TRANSLATION_DATA,i("body").on("click.pwad",".pwad-set-focal-point",b),i("body").on("click.pwad",".pwad-save-focal-point",C),i("body").on("change.pwad",".pwad-select-focal-point-preview",y),i("body").on("click.pwad",".pwad-clear-cache",k),w(),setInterval(w,500))}),i.extend(a.Uploader.prototype,{success:function(a){a.id}})}(jQuery,wp);